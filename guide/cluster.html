<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2d89ef"><meta name="msapplication-TileColor" content="#2d89ef"><meta name="theme-color" content="#ffffff"><title>Cluster | room-assistant</title><meta name="description" content="A companion software to bring your home automation to the room-level for presence detection and more.">
    <link rel="modulepreload" href="/assets/app.86f309b6.js"><link rel="modulepreload" href="/assets/cluster.html.4414ba8d.js"><link rel="modulepreload" href="/assets/cluster.html.e2ac4b0f.js"><link rel="prefetch" href="/assets/index.html.847a1389.js"><link rel="prefetch" href="/assets/privacy.html.d533dcd2.js"><link rel="prefetch" href="/assets/index.html.34fb4829.js"><link rel="prefetch" href="/assets/api.html.7036c1ff.js"><link rel="prefetch" href="/assets/cli.html.a49db415.js"><link rel="prefetch" href="/assets/configuration.html.f0b5f8f8.js"><link rel="prefetch" href="/assets/entities.html.b334b998.js"><link rel="prefetch" href="/assets/installation.html.64c3bf2a.js"><link rel="prefetch" href="/assets/monitoring.html.1c54c424.js"><link rel="prefetch" href="/assets/quickstart-ansible.html.6811f207.js"><link rel="prefetch" href="/assets/quickstart-docker.html.78d00105.js"><link rel="prefetch" href="/assets/quickstart-pi-zero-w.html.387c5159.js"><link rel="prefetch" href="/assets/quickstart-pi.html.43ecd744.js"><link rel="prefetch" href="/assets/upgrading.html.17a0c2d4.js"><link rel="prefetch" href="/assets/index.html.ce48dbd0.js"><link rel="prefetch" href="/assets/bluetooth-classic.html.377e8781.js"><link rel="prefetch" href="/assets/bluetooth-low-energy.html.543a36a3.js"><link rel="prefetch" href="/assets/gpio.html.32f147c4.js"><link rel="prefetch" href="/assets/grid-eye.html.0e750691.js"><link rel="prefetch" href="/assets/home-assistant.html.9ec7d577.js"><link rel="prefetch" href="/assets/mqtt.html.e1c2b9d1.js"><link rel="prefetch" href="/assets/omron-d6t.html.08b56b57.js"><link rel="prefetch" href="/assets/shell.html.92a8a599.js"><link rel="prefetch" href="/assets/xiaomi-mi.html.7b5eb585.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/index.html.3d0f8a46.js"><link rel="prefetch" href="/assets/privacy.html.8969f5ba.js"><link rel="prefetch" href="/assets/index.html.0fb718cb.js"><link rel="prefetch" href="/assets/api.html.b89cf6d4.js"><link rel="prefetch" href="/assets/cli.html.aa5cd049.js"><link rel="prefetch" href="/assets/configuration.html.f90153bf.js"><link rel="prefetch" href="/assets/entities.html.f0170af1.js"><link rel="prefetch" href="/assets/installation.html.62a12c2d.js"><link rel="prefetch" href="/assets/monitoring.html.1006c07a.js"><link rel="prefetch" href="/assets/quickstart-ansible.html.820e4d72.js"><link rel="prefetch" href="/assets/quickstart-docker.html.8482241a.js"><link rel="prefetch" href="/assets/quickstart-pi-zero-w.html.f4c9ce76.js"><link rel="prefetch" href="/assets/quickstart-pi.html.97b09e17.js"><link rel="prefetch" href="/assets/upgrading.html.8d7e94c1.js"><link rel="prefetch" href="/assets/index.html.4b80791f.js"><link rel="prefetch" href="/assets/bluetooth-classic.html.4c882563.js"><link rel="prefetch" href="/assets/bluetooth-low-energy.html.c5247788.js"><link rel="prefetch" href="/assets/gpio.html.82caa840.js"><link rel="prefetch" href="/assets/grid-eye.html.15e58515.js"><link rel="prefetch" href="/assets/home-assistant.html.c78d66da.js"><link rel="prefetch" href="/assets/mqtt.html.a0d07034.js"><link rel="prefetch" href="/assets/omron-d6t.html.210c352e.js"><link rel="prefetch" href="/assets/shell.html.2d168ef2.js"><link rel="prefetch" href="/assets/xiaomi-mi.html.1ae21ed0.js"><link rel="prefetch" href="/assets/404.html.e57d1573.js">
    <link rel="stylesheet" href="/assets/style.0c07b545.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">room-assistant</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Cluster <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/cluster.html#usage-tips" class="router-link-active router-link-exact-active sidebar-item" aria-label="Usage tips"><!--[--><!--]--> Usage tips <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/cluster.html#preferred-leaders" class="router-link-active router-link-exact-active sidebar-item" aria-label="Preferred leaders"><!--[--><!--]--> Preferred leaders <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/guide/cluster.html#troubleshooting" class="router-link-active router-link-exact-active sidebar-item" aria-label="Troubleshooting"><!--[--><!--]--> Troubleshooting <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/cluster.html#some-nodes-not-appearing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Some nodes not appearing"><!--[--><!--]--> Some nodes not appearing <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/cluster.html#mdns-errors" class="router-link-active router-link-exact-active sidebar-item" aria-label="MDNS errors"><!--[--><!--]--> MDNS errors <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/cluster.html#getaddrinfo-errors" class="router-link-active router-link-exact-active sidebar-item" aria-label="getaddrinfo errors"><!--[--><!--]--> getaddrinfo errors <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/cluster.html#rivalling-clusters" class="router-link-active router-link-exact-active sidebar-item" aria-label="Rivalling clusters"><!--[--><!--]--> Rivalling clusters <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/guide/cluster.html#settings" class="router-link-active router-link-exact-active sidebar-item" aria-label="Settings"><!--[--><!--]--> Settings <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="cluster" tabindex="-1"><a class="header-anchor" href="#cluster" aria-hidden="true">#</a> Cluster</h1><p><strong>Config Key:</strong> <code>cluster</code></p><p>If you are running multiple room-assistant instances they come together in a cluster. By default, the instances discover each other using mDNS. This requires all of them live in the same subnet. You can also specify the adresses of other instances and tweak some other things manually.</p><h2 id="usage-tips" tabindex="-1"><a class="header-anchor" href="#usage-tips" aria-hidden="true">#</a> Usage tips</h2><h3 id="preferred-leaders" tabindex="-1"><a class="header-anchor" href="#preferred-leaders" aria-hidden="true">#</a> Preferred leaders</h3><p>In some situations you may want some instances of room-assistant to be the leading ones more than others. This could for example be the case if you have instances that are connected to the network better than others. To accomplish this you can configure custom weights that are then used during the leader election process. The <code>weight</code> option should ideally be configured on every instance of room-assistant that you run to achieve consistent behavior. The preferred leader instances need to have the largest weight numbers.</p><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting" aria-hidden="true">#</a> Troubleshooting</h2><h3 id="some-nodes-not-appearing" tabindex="-1"><a class="header-anchor" href="#some-nodes-not-appearing" aria-hidden="true">#</a> Some nodes not appearing</h3><p>If the auto discovery does not seem to pick up all (or any) nodes for your cluster you can approach the problem from two different directions:</p><ol><li>Make sure your router and network settings are compatible with mDNS/Bonjour. An easy way to test this is pinging your devices by their hostname, e.g. <code>ping raspberrypi.local</code>.</li><li>Disable <code>autoDiscovery</code> and provide the <code>peerAddresses</code> manually. Make sure to give your devices DHCP reservations or static IPs.</li></ol><p>Should the other nodes not appear in your cluster even after configuring it manually you should make sure that the devices can communication with each other via UDP on the port you configured, by default <code>6425</code>.</p><h3 id="mdns-errors" tabindex="-1"><a class="header-anchor" href="#mdns-errors" aria-hidden="true">#</a> MDNS errors</h3><p>If you&#39;re seeing errors relating to MDNS discovery in your logs there is no need to worry - room-assistant will function fine even without it. In this case you can just specify the <code>peerAddresses</code> of your other room-assistant instances manually.</p><p>If you want to fix the discovery issues you need to take a look at <a href="http://avahi.org" target="_blank" rel="noopener noreferrer">Avahi<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> on Linux or the equivalent Bonjour responder on other operating systems. It needs to be installed and available to room-assistant.</p><p>As for Docker, the auto discovery will only work if you&#39;re running the container on a Linux machine and have mapped the <code>/var/run/dbus</code> volume.</p><h3 id="getaddrinfo-errors" tabindex="-1"><a class="header-anchor" href="#getaddrinfo-errors" aria-hidden="true">#</a> getaddrinfo errors</h3><p>This error correlates to your machine not being able to resolve <code>.local</code> hostnames correctly. On Linux systems you need to have <a href="http://0pointer.de/lennart/projects/nss-mdns/" target="_blank" rel="noopener noreferrer">nss-mdns<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> installed and configured for this to work. Alternatively you can use the <code>--digResolver</code> CLI option when starting room-assistant to use the <code>dig</code> command for resolving hostnames.</p><h3 id="rivalling-clusters" tabindex="-1"><a class="header-anchor" href="#rivalling-clusters" aria-hidden="true">#</a> Rivalling clusters</h3><p>If you&#39;re seeing multiple clusters form on your network that are both trying to take control of the distributed entities you can set the <code>quorum</code> option. This ensures that only a cluster that contains the majority of instances can update the values. Set this number so that it represents the smallest instance count to constitute a majority in your setup. For example: if you have 3 instances of the software at home you would set <code>quorum</code> to 2, for 6 overall instances it should be 4.</p><h2 id="settings" tabindex="-1"><a class="header-anchor" href="#settings" aria-hidden="true">#</a> Settings</h2><table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>networkInterface</code></td><td>String</td><td></td><td>The specific network interface that room-assistant should advertise its presence on, e.g. <code>eth0</code>.</td></tr><tr><td><code>port</code></td><td>Number</td><td><code>6425</code></td><td>The UDP port that room-assistant should use for internal communication.</td></tr><tr><td><code>timeout</code></td><td>Number</td><td><code>60</code></td><td>Number of seconds that an instance can go without sending a heartbeat and not be dropped from the cluster.</td></tr><tr><td><code>weight</code></td><td>Number</td><td>Random</td><td>Value used to sort when electing a leading instance. The instance with the highest weight in the cluster becomes the leader.</td></tr><tr><td><code>quorum</code></td><td>Number</td><td></td><td>Minimum amount of nodes required for the cluster to represent the majority.</td></tr><tr><td><code>autoDiscovery</code></td><td>Boolean</td><td><code>true</code></td><td>Allows mDNS-based auto discovery of other room-assistant instances to be turned off.</td></tr><tr><td><code>peerAddresses</code></td><td>Array</td><td></td><td>A list of endpoint addresses (IP + port) of other room-assistant instances.</td></tr></tbody></table><details class="custom-container details"><summary>Example Config</summary><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">cluster</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6425</span>
  <span class="token key atrule">peerAddresses</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 192.168.1.10<span class="token punctuation">:</span><span class="token number">6425</span>
    <span class="token punctuation">-</span> 192.168.1.11<span class="token punctuation">:</span><span class="token number">6425</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: legovaer@me.com">Levi Govaerts</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.86f309b6.js" defer></script>
  </body>
</html>
